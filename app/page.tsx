'use client';

import { useState } from 'react';

interface StoryScene {
  id: number;
  text: string;
  image: string;
  choices?: { text: string; next: number; loyalty: number }[];
  ending?: boolean;
  loyaltyMessage?: string;
}

export default function LoyaltyStory() {
  const [currentScene, setCurrentScene] = useState(0);
  const [loyaltyScore, setLoyaltyScore] = useState(50);
  const [showDefinition, setShowDefinition] = useState(false);

  const scenes: StoryScene[] = [
    {
      id: 0,
      text: "рдпрд╣ рд╣реИ рд░рд╛рдЬ рдФрд░ рдЙрд╕рдХреЗ рдХреБрддреНрддреЗ рдЯрд╛рдЗрдЧрд░ рдХреА рдХрд╣рд╛рдиреАред рд░рд╛рдЬ рдПрдХ рд╕рд╛рдзрд╛рд░рдг рдпреБрд╡рдХ рдерд╛, рдФрд░ рдЯрд╛рдЗрдЧрд░ рдЙрд╕рдХрд╛ рд╕рдмрд╕реЗ рдЕрдЪреНрдЫрд╛ рджреЛрд╕реНрддред рдЖрдЬ рд╕реЗ 5 рд╕рд╛рд▓ рдкрд╣рд▓реЗ, рдЬрдм рдЯрд╛рдЗрдЧрд░ рд╕рд┐рд░реНрдл рдПрдХ рдЫреЛрдЯрд╛ рдкрд┐рд▓реНрд▓рд╛ рдерд╛, рд░рд╛рдЬ рдиреЗ рдЙрд╕реЗ рд╕рдбрд╝рдХ рдкрд░ рдмрд╛рд░рд┐рд╢ рдореЗрдВ рднреАрдЧрддреЗ рд╣реБрдП рдкрд╛рдпрд╛ рдерд╛ред",
      image: "ЁЯРХ",
      choices: [
        { text: "рдХрд╣рд╛рдиреА рд╢реБрд░реВ рдХрд░реЗрдВ", next: 1, loyalty: 0 }
      ]
    },
    {
      id: 1,
      text: "рдПрдХ рджрд┐рди рд░рд╛рдЬ рдХреА рдиреМрдХрд░реА рдЪрд▓реА рдЧрдИред рдЙрд╕рдХреЗ рдкрд╛рд╕ рдкреИрд╕реЗ рдирд╣реАрдВ рдереЗ, рдШрд░ рдХрд╛ рдХрд┐рд░рд╛рдпрд╛ рдирд╣реАрдВ рджреЗ рдкрд╛ рд░рд╣рд╛ рдерд╛ред рдЙрд╕рдХреЗ рджреЛрд╕реНрдд рдПрдХ-рдПрдХ рдХрд░рдХреЗ рдЙрд╕рд╕реЗ рджреВрд░ рд╣реЛрдиреЗ рд▓рдЧреЗред рд▓реЗрдХрд┐рди рдЯрд╛рдЗрдЧрд░... рдЯрд╛рдЗрдЧрд░ рд╣рдореЗрд╢рд╛ рдЙрд╕рдХреЗ рдкрд╛рд╕ рд░рд╣рд╛ред рднреВрдЦрд╛ рд░рд╣рдХрд░ рднреА, рд╡реЛ рд░рд╛рдЬ рдХреЗ рдкреИрд░реЛрдВ рдореЗрдВ рд╕реЛрддрд╛ рдерд╛ред",
      image: "ЁЯШФ",
      choices: [
        { text: "рдЖрдЧреЗ рдмрдврд╝реЗрдВ", next: 2, loyalty: 5 }
      ]
    },
    {
      id: 2,
      text: "рдорд╣реАрдиреЗ рдмрд╛рдж, рд░рд╛рдЬ рдХреЛ рджреВрд╕рд░реЗ рд╢рд╣рд░ рдореЗрдВ рдиреМрдХрд░реА рдорд┐рд▓реАред рд▓реЗрдХрд┐рди рдЬрд╣рд╛рдВ рд╡реЛ рдЬрд╛ рд░рд╣рд╛ рдерд╛, рд╡рд╣рд╛рдВ рдкрд╛рд▓рддреВ рдЬрд╛рдирд╡рд░ рд░рдЦрдирд╛ рдордирд╛ рдерд╛ред рдЙрд╕рдХрд╛ рджреЛрд╕реНрдд рд╕реЛрд╣рди рдмреЛрд▓рд╛, 'рдпрд╛рд░, рдЯрд╛рдЗрдЧрд░ рдХреЛ рдореЗрд░реЗ рдкрд╛рд╕ рдЫреЛрдбрд╝ рджреЗ, рдореИрдВ рд░рдЦ рд▓реВрдВрдЧрд╛ред' рдЖрдк рд░рд╛рдЬ рдХреА рдЬрдЧрд╣ рдкрд░ рдХреНрдпрд╛ рдХрд░реЗрдВрдЧреЗ?",
      image: "ЁЯдФ",
      choices: [
        { text: "рдЯрд╛рдЗрдЧрд░ рдХреЛ рд╕реЛрд╣рди рдХреЗ рдкрд╛рд╕ рдЫреЛрдбрд╝ рджреЛ рдФрд░ рдиреМрдХрд░реА join рдХрд░реЛ", next: 3, loyalty: -20 },
        { text: "рдиреМрдХрд░реА рдЫреЛрдбрд╝ рджреЛ, рдЯрд╛рдЗрдЧрд░ рдХреЗ рд╕рд╛рде рдХреБрдЫ рдФрд░ рдвреВрдВрдвреЛ", next: 4, loyalty: 30 }
      ]
    },
    {
      id: 3,
      text: "рд░рд╛рдЬ рдиреЗ рдЯрд╛рдЗрдЧрд░ рдХреЛ рд╕реЛрд╣рди рдХреЗ рдкрд╛рд╕ рдЫреЛрдбрд╝ рджрд┐рдпрд╛ рдФрд░ рд╢рд╣рд░ рдЪрд▓рд╛ рдЧрдпрд╛ред рдкрд╣рд▓реЗ рдХреБрдЫ рд╣рдлреНрддреЗ рдЕрдЪреНрдЫреЗ рд░рд╣реЗред рд▓реЗрдХрд┐рди рдлрд┐рд░ рдПрдХ рджрд┐рди рд╕реЛрд╣рди рдХрд╛ рдлреЛрди рдЖрдпрд╛ - 'рдпрд╛рд░, рдЯрд╛рдЗрдЧрд░ рдЦрд╛рдирд╛ рдирд╣реАрдВ рдЦрд╛ рд░рд╣рд╛, рд╕рд┐рд░реНрдл рджрд░рд╡рд╛рдЬреЗ рдкрд░ рдмреИрдард╛ рддреЗрд░рд╛ рдЗрдВрддрдЬрд╛рд░ рдХрд░рддрд╛ рд╣реИред' рд░рд╛рдЬ рдХрд╛ рджрд┐рд▓ рдмреИрда рдЧрдпрд╛ред рдЬрд┐рд╕рдиреЗ рдХрднреА рдЙрд╕рдХрд╛ рд╕рд╛рде рдирд╣реАрдВ рдЫреЛрдбрд╝рд╛, рдЙрд╕реЗ рдЙрд╕рдиреЗ рдЫреЛрдбрд╝ рджрд┐рдпрд╛ рдерд╛ред",
      image: "ЁЯТФ",
      ending: true,
      loyaltyMessage: "Loyalty ek рддрд░рдлрд╛ рдирд╣реАрдВ рд╣реЛрддреАред рдЬрдм рд╣рдо рдХрд┐рд╕реА рдХреЗ рдкреНрд░рддрд┐ рд╡рдлрд╛рджрд╛рд░ рд╣реЛрддреЗ рд╣реИрдВ, рддреЛ рд╣рдореЗрдВ рднреА рдЙрд╕рдХреЗ рдкреНрд░рддрд┐ рд╡рдлрд╛рджрд╛рд░ рд░рд╣рдирд╛ рдЪрд╛рд╣рд┐рдПред рд░рд╛рдЬ рдиреЗ рдЕрдкрдиреА рд╕реБрд╡рд┐рдзрд╛ рдХреЗ рд▓рд┐рдП рдЯрд╛рдЗрдЧрд░ рдХреА loyalty рдХреЛ рднреВрд▓ рдЧрдпрд╛ред"
    },
    {
      id: 4,
      text: "рд░рд╛рдЬ рдиреЗ рдиреМрдХрд░реА рдЫреЛрдбрд╝ рджреАред 'рдЯрд╛рдЗрдЧрд░ рдиреЗ рдореБрдЭреЗ рдХрднреА рдирд╣реАрдВ рдЫреЛрдбрд╝рд╛, рдореИрдВ рдЗрд╕реЗ рдХреИрд╕реЗ рдЫреЛрдбрд╝ рд╕рдХрддрд╛ рд╣реВрдВ?' рдЙрд╕рдиреЗ рд╢рд╣рд░ рдореЗрдВ рд╣реА рдЫреЛрдЯреЗ-рдореЛрдЯреЗ рдХрд╛рдо рдХрд░рдирд╛ рд╢реБрд░реВ рдХрд┐рдпрд╛ред рдореБрд╢реНрдХрд┐рд▓ рдерд╛, рд▓реЗрдХрд┐рди рдЯрд╛рдЗрдЧрд░ рд╣рдореЗрд╢рд╛ рдЙрд╕рдХреЗ рд╕рд╛рде рдерд╛ред рдПрдХ рджрд┐рди рдПрдХ рдмреБрдЬреБрд░реНрдЧ рдЖрджрдореА рдиреЗ рд░рд╛рдЬ рдХреЛ рдХрд╛рдо рдХрд░рддреЗ рджреЗрдЦрд╛...",
      image: "ЁЯТк",
      choices: [
        { text: "рдЖрдЧреЗ рдмрдврд╝реЗрдВ", next: 5, loyalty: 10 }
      ]
    },
    {
      id: 5,
      text: "рдмреБрдЬреБрд░реНрдЧ рдЖрджрдореА рдиреЗ рдкреВрдЫрд╛, 'рдмреЗрдЯрд╛, рдЗрддрдиреА рдореЗрд╣рдирдд рдХреНрдпреЛрдВ рдХрд░ рд░рд╣реЗ рд╣реЛ?' рд░рд╛рдЬ рдиреЗ рдЯрд╛рдЗрдЧрд░ рдХреА рддрд░рдл рдЗрд╢рд╛рд░рд╛ рдХрд┐рдпрд╛, 'рдЗрд╕рдиреЗ рдореЗрд░реЗ рдмреБрд░реЗ рд╡рдХреНрдд рдореЗрдВ рд╕рд╛рде рджрд┐рдпрд╛, рдЕрдм рдореЗрд░реА рдмрд╛рд░реА рд╣реИред' рдмреБрдЬреБрд░реНрдЧ рдЖрджрдореА рдореБрд╕реНрдХреБрд░рд╛рдП - 'рдореИрдВ рдПрдХ company рдХрд╛ рдорд╛рд▓рд┐рдХ рд╣реВрдВ, рдФрд░ рдореБрдЭреЗ рддреБрдореНрд╣рд╛рд░реЗ рдЬреИрд╕реЗ loyal рдЗрдВрд╕рд╛рди рдХреА рддрд▓рд╛рд╢ рдереАред рдХрд▓ рд╕реЗ рдореЗрд░реА office рдЖрдирд╛, рддреБрдореНрд╣реЗрдВ рдЕрдЪреНрдЫреА job рджреВрдВрдЧрд╛ред'",
      image: "ЁЯМЯ",
      choices: [
        { text: "рдЖрдЧреЗ рдмрдврд╝реЗрдВ", next: 6, loyalty: 15 }
      ]
    },
    {
      id: 6,
      text: "рд░рд╛рдЬ рдХреЛ рдЕрдЪреНрдЫреА рдиреМрдХрд░реА рдорд┐рд▓ рдЧрдИ, рдФрд░ рдЗрд╕ рдмрд╛рд░ рдЯрд╛рдЗрдЧрд░ рднреА рдЙрд╕рдХреЗ рд╕рд╛рде рдерд╛ред рдХреБрдЫ рд╕рд╛рд▓ рдмрд╛рдж, рд░рд╛рдЬ рдХреА рдЦреБрдж рдХреА company рдмрди рдЧрдИред рдПрдХ рджрд┐рди office рдореЗрдВ fire рд▓рдЧ рдЧрдИред рд╕рдм рд▓реЛрдЧ рднрд╛рдЧ рдЧрдП, рд▓реЗрдХрд┐рди рд░рд╛рдЬ рдХрд╛ рдЫреЛрдЯрд╛ рдмреЗрдЯрд╛ рдЕрдВрджрд░ рдлрдВрд╕ рдЧрдпрд╛ рдерд╛ред рдЯрд╛рдЗрдЧрд░, рдЕрдм рдмреВрдврд╝рд╛ рд╣реЛ рдЪреБрдХрд╛ рдерд╛, рд▓реЗрдХрд┐рди рд╡реЛ рдЕрдВрджрд░ рдЧрдпрд╛ рдФрд░ рдмрдЪреНрдЪреЗ рдХреЛ рдмрд╛рд╣рд░ рд▓рд╛рдпрд╛ред рдЙрд╕ рджрд┐рди рдЯрд╛рдЗрдЧрд░ рдмреБрд░реА рддрд░рд╣ рдЬрдЦреНрдореА рд╣реЛ рдЧрдпрд╛ред",
      image: "ЁЯФе",
      choices: [
        { text: "рдЖрдЧреЗ рдмрдврд╝реЗрдВ", next: 7, loyalty: 5 }
      ]
    },
    {
      id: 7,
      text: "рд░рд╛рдЬ рдиреЗ рдЯрд╛рдЗрдЧрд░ рдХреА рдЬрд╛рди рдмрдЪрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рджреЗрд╢ рдХреЗ рд╕рдмрд╕реЗ рдЕрдЪреНрдЫреЗ doctor рдХреЛ рдмреБрд▓рд╛рдпрд╛ред рдорд╣реАрдиреЛрдВ treatment рдЪрд▓рд╛ред рд░рд╛рдЬ рдиреЗ рдХрд╣рд╛, 'рдЗрд╕рдиреЗ рдореЗрд░реЗ рд▓рд┐рдП рд╕рдм рдХреБрдЫ рдХрд┐рдпрд╛ рд╣реИ, рдЕрдм рдореИрдВ рдЗрд╕рдХреЗ рд▓рд┐рдП рдХреБрдЫ рднреА рдХрд░реВрдВрдЧрд╛ред' рдЖрдЬ рдЯрд╛рдЗрдЧрд░ рдареАрдХ рд╣реИ, рдмреВрдврд╝рд╛ рд╣реИ рд▓реЗрдХрд┐рди рд░рд╛рдЬ рдХреЗ рд╕рд╛рде рдЦреБрд╢ рд╣реИред",
      image: "тЭдя╕П",
      ending: true,
      loyaltyMessage: "рдпрд╣реА рд╣реИ рдЕрд╕рд▓реА loyalty - рдмреБрд░реЗ рд╡рдХреНрдд рдореЗрдВ рд╕рд╛рде рджреЗрдирд╛, рдЕрдкрдиреА рд╕реБрд╡рд┐рдзрд╛ рд╕реЗ рдкрд╣рд▓реЗ рдЕрдкрдиреЗ рдкреНрдпрд╛рд░реЛрдВ рдХреЛ рд░рдЦрдирд╛, рдФрд░ рдЬреАрд╡рди рднрд░ рдирд┐рднрд╛рдирд╛ред Loyalty рд╕рд┐рд░реНрдл рдЗрдВрд╕рд╛рдиреЛрдВ рдореЗрдВ рдирд╣реАрдВ, рдЬрд╛рдирд╡рд░реЛрдВ рдореЗрдВ рднреА рд╣реЛрддреА рд╣реИред рдФрд░ рдЬрдм loyalty рджреЛрдиреЛрдВ рддрд░рдл рд╕реЗ рд╣реЛ, рддреЛ life рдореЗрдВ рдХреЛрдИ рдореБрд╢реНрдХрд┐рд▓ рдирд╣реАрдВ рдЬреЛ рдЖрдк рдирд╛ рдкрд╛рд░ рдХрд░ рд╕рдХреЗрдВред"
    }
  ];

  const handleChoice = (next: number, loyaltyChange: number) => {
    setLoyaltyScore(prev => Math.max(0, Math.min(100, prev + loyaltyChange)));
    setCurrentScene(next);
  };

  const restartStory = () => {
    setCurrentScene(0);
    setLoyaltyScore(50);
  };

  const scene = scenes[currentScene];

  return (
    <div style={{
      minHeight: '100vh',
      background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
      padding: '20px',
      fontFamily: 'system-ui, -apple-system, sans-serif'
    }}>
      <div style={{
        maxWidth: '800px',
        margin: '0 auto',
        background: 'white',
        borderRadius: '20px',
        padding: '40px',
        boxShadow: '0 20px 60px rgba(0,0,0,0.3)'
      }}>
        <h1 style={{
          textAlign: 'center',
          color: '#667eea',
          fontSize: '2.5rem',
          marginBottom: '10px'
        }}>
          рд╡рдлрд╛рджрд╛рд░реА рдХреА рдХрд╣рд╛рдиреА
        </h1>

        <div style={{
          textAlign: 'center',
          marginBottom: '30px'
        }}>
          <button
            onClick={() => setShowDefinition(!showDefinition)}
            style={{
              background: '#764ba2',
              color: 'white',
              border: 'none',
              padding: '10px 20px',
              borderRadius: '10px',
              cursor: 'pointer',
              fontSize: '1rem'
            }}
          >
            {showDefinition ? 'Definition рдЫреБрдкрд╛рдПрдВ' : 'Loyalty рдХреНрдпрд╛ рд╣реИ?'}
          </button>
        </div>

        {showDefinition && (
          <div style={{
            background: '#f0f4ff',
            padding: '20px',
            borderRadius: '10px',
            marginBottom: '30px',
            borderLeft: '4px solid #667eea'
          }}>
            <h3 style={{ color: '#667eea', marginTop: 0 }}>Loyalty (рд╡рдлрд╛рджрд╛рд░реА) рдХреНрдпрд╛ рд╣реЛрддреА рд╣реИ?</h3>
            <p style={{ margin: '10px 0', lineHeight: '1.6' }}>
              <strong>Loyalty</strong> рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐рд╕реА рдХреЗ рдкреНрд░рддрд┐ рд╕рдЪреНрдЪреА рдирд┐рд╖реНрдард╛ рдФрд░ рд╕рдорд░реНрдкрдг рд░рдЦрдирд╛ред
              рдпрд╣ рд╣реИ рдХрд┐рд╕реА рдХрд╛ рд╕рд╛рде рдмреБрд░реЗ рд╡рдХреНрдд рдореЗрдВ рднреА рджреЗрдирд╛, рдзреЛрдЦрд╛ рдирд╛ рджреЗрдирд╛, рдФрд░ рд╣рдореЗрд╢рд╛ рдЙрдирдХреЗ рднрд▓рд╛рдИ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд╕реЛрдЪрдирд╛ред
            </p>
            <p style={{ margin: '10px 0', lineHeight: '1.6' }}>
              Loyalty рд╕рд┐рд░реНрдл рд╢рдмреНрджреЛрдВ рдореЗрдВ рдирд╣реАрдВ, рдХрд░реНрдореЛрдВ рдореЗрдВ рджрд┐рдЦрддреА рд╣реИред рдпрд╣ рджреЛрд╕реНрддреА рдореЗрдВ, рд░рд┐рд╢реНрддреЛрдВ рдореЗрдВ,
              рдФрд░ рдпрд╣рд╛рдВ рддрдХ рдХрд┐ рдЬрд╛рдирд╡рд░реЛрдВ рдореЗрдВ рднреА рд╣реЛрддреА рд╣реИред рдПрдХ loyal рдЗрдВрд╕рд╛рди рдпрд╛ рдЬрд╛рдирд╡рд░ рдХрднреА рдЕрдкрдиреЗ рдкреНрдпрд╛рд░реЛрдВ рдХреЛ рдореБрд╢реНрдХрд┐рд▓ рдореЗрдВ рдирд╣реАрдВ рдЫреЛрдбрд╝рддрд╛ред
            </p>
          </div>
        )}

        <div style={{
          background: '#f8f9ff',
          padding: '15px',
          borderRadius: '10px',
          marginBottom: '30px',
          display: 'flex',
          justifyContent: 'space-between',
          alignItems: 'center'
        }}>
          <span style={{ fontWeight: 'bold', color: '#667eea' }}>Loyalty Score:</span>
          <div style={{
            flex: 1,
            margin: '0 20px',
            height: '20px',
            background: '#e0e0e0',
            borderRadius: '10px',
            overflow: 'hidden'
          }}>
            <div style={{
              width: `${loyaltyScore}%`,
              height: '100%',
              background: loyaltyScore > 70 ? '#4caf50' : loyaltyScore > 40 ? '#ff9800' : '#f44336',
              transition: 'width 0.5s ease'
            }} />
          </div>
          <span style={{ fontWeight: 'bold', color: '#667eea' }}>{loyaltyScore}%</span>
        </div>

        <div style={{
          textAlign: 'center',
          fontSize: '6rem',
          marginBottom: '20px'
        }}>
          {scene.image}
        </div>

        <p style={{
          fontSize: '1.2rem',
          lineHeight: '1.8',
          color: '#333',
          marginBottom: '30px',
          textAlign: 'justify'
        }}>
          {scene.text}
        </p>

        {scene.ending && scene.loyaltyMessage && (
          <div style={{
            background: loyaltyScore > 70 ? '#e8f5e9' : '#fff3e0',
            padding: '20px',
            borderRadius: '10px',
            marginBottom: '20px',
            borderLeft: `4px solid ${loyaltyScore > 70 ? '#4caf50' : '#ff9800'}`
          }}>
            <h3 style={{
              color: loyaltyScore > 70 ? '#2e7d32' : '#e65100',
              marginTop: 0
            }}>
              ЁЯТб Lesson
            </h3>
            <p style={{ lineHeight: '1.6', margin: 0 }}>
              {scene.loyaltyMessage}
            </p>
          </div>
        )}

        <div style={{
          display: 'flex',
          flexDirection: 'column',
          gap: '15px'
        }}>
          {scene.choices?.map((choice, idx) => (
            <button
              key={idx}
              onClick={() => handleChoice(choice.next, choice.loyalty)}
              style={{
                background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                color: 'white',
                border: 'none',
                padding: '15px 30px',
                borderRadius: '10px',
                fontSize: '1.1rem',
                cursor: 'pointer',
                transition: 'transform 0.2s',
                boxShadow: '0 4px 15px rgba(0,0,0,0.2)'
              }}
              onMouseOver={(e) => e.currentTarget.style.transform = 'scale(1.05)'}
              onMouseOut={(e) => e.currentTarget.style.transform = 'scale(1)'}
            >
              {choice.text}
            </button>
          ))}

          {scene.ending && (
            <button
              onClick={restartStory}
              style={{
                background: '#4caf50',
                color: 'white',
                border: 'none',
                padding: '15px 30px',
                borderRadius: '10px',
                fontSize: '1.1rem',
                cursor: 'pointer',
                transition: 'transform 0.2s',
                boxShadow: '0 4px 15px rgba(0,0,0,0.2)'
              }}
              onMouseOver={(e) => e.currentTarget.style.transform = 'scale(1.05)'}
              onMouseOut={(e) => e.currentTarget.style.transform = 'scale(1)'}
            >
              ЁЯФД рдХрд╣рд╛рдиреА рдлрд┐рд░ рд╕реЗ рд╢реБрд░реВ рдХрд░реЗрдВ
            </button>
          )}
        </div>

        <div style={{
          marginTop: '30px',
          padding: '15px',
          background: '#f0f4ff',
          borderRadius: '10px',
          textAlign: 'center',
          fontSize: '0.9rem',
          color: '#666'
        }}>
          <p style={{ margin: 0 }}>
            рдпрд╣ рдПрдХ interactive story рд╣реИ рдЬреЛ рдЖрдкрдХреЛ loyalty рдХреЗ рдорд╛рдпрдиреЗ рд╕рдордЭрд╛рддреА рд╣реИред
            рдЖрдкрдХреА choices рдЖрдкрдХреА loyalty score рдХреЛ affect рдХрд░рддреА рд╣реИрдВред
          </p>
        </div>
      </div>
    </div>
  );
}
